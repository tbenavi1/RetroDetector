configfile: "config/config.yaml"


include: "rules/common.smk"
include: "rules/initial_setup.smk"
include: "rules/map_reads.smk"
include: "rules/process_bams.smk"
include: "rules/find_retrogenes.smk"
include: "rules/anchor_retrogenes.smk"
include: "rules/get_supporting_alignments.smk"
include: "rules/process_results.smk"


rule all:
    input:
        expand(
            "results/BAMS/{ref}/{sample}/transcriptome/short/{ref}.{sample}.transcriptome.short.sorted.bam",
            ref=config["ref"],
            sample=short_samples,
        ),
        expand(
            "results/BAMS/{ref}/{sample}/transcriptome/long/{ref}.{sample}.transcriptome.long.sorted.bam",
            ref=config["ref"],
            sample=long_samples,
        ),
        expand(
            "results/BAMS/{ref}/{sample}/genome/short/{ref}.{sample}.genome.short.sorted.bam.bai",
            ref=config["ref"],
            sample=short_samples,
        ),
        expand(
            "results/BAMS/{ref}/{sample}/genome/long/{ref}.{sample}.genome.long.sorted.bam.bai",
            ref=config["ref"],
            sample=long_samples,
        ),
        expand(
            "results/Spanned/{ref}/{sample}/long/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.longreads.spannedjunctions.tsv",
            ref=config["ref"],
            sample=long_samples,
            junction_overhang=config["junction_overhang"],
            insertions_threshold=config["insertions_threshold"],
        ),
        expand(
            "results/AS/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.genome.AS",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/AS/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.genome.clustered.AS",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/AS/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.genome.best.AS",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/AS/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.genome.best.AS.diff",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/retrogenes/{ref}/{sample}/long/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.retrogenes.supportingalignments.genome.sorted.bam.bai",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/retrogenes/{ref}/{sample}/long/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.retrogenes.final.results.tsv",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/retrogenes/{ref}/{sample}/long/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.retrogenes.final.mainchrom.results.tsv",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/retrogenes/{ref}/{sample}/long/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.retrogenes.chrommovement.results.tsv",
        ref=config["ref"],
        sample=long_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
        ),
        expand(
            "results/Spanned/{ref}/{sample}/short/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.shortreads.spannedjunctions.tsv",
            ref=config["ref"],
            sample=short_samples,
            junction_overhang=config["junction_overhang"],
            insertions_threshold=config["insertions_threshold"],
        ),
        expand(
            "results/Summary/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.{strongthreshold}.results.txt",
        ref=config["ref"],
        sample=short_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
            strongthreshold=config[
                "short_read_strong_spanning_alignment_expected_genomic_insertion_size_threshold"
            ],
        ),
        expand(
            "results/Summary/{ref}/{sample}/{ref}.{sample}.junctover{junction_overhang}.insertthresh{insertions_threshold}.totalsupport{junction_total_read_support_threshold}.{strongthreshold}.results2.txt",
        ref=config["ref"],
        sample=short_samples,
        junction_overhang=config["junction_overhang"],
        insertions_threshold=config["insertions_threshold"],
        junction_total_read_support_threshold=config[
        "junction_total_read_support_threshold"
            ],
            strongthreshold=config[
                "short_read_strong_spanning_alignment_expected_genomic_insertion_size_threshold"
            ],
        ),
